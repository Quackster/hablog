VERSION 5.00
Begin VB.Form frmMain
  Caption = "Version 9 -- Revision 169"
  BackColor = &HE0E0E0&
  ScaleMode = 1
  AutoRedraw = True
  FontTransparent = True
  BorderStyle = 0 'None
  Icon = "frmMain.frx":0000
  LinkTopic = "-- DebboProject V3 --"
  MaxButton = 0   'False
  MinButton = 0   'False
  ClientLeft = 2445
  ClientTop = 1980
  ClientWidth = 10050
  ClientHeight = 7425
  ShowInTaskbar = 0   'False
  Begin VB.TextBox furni_2
    Left = 2040
    Top = 8040
    Width = 5775
    Height = 4215
    Visible = 0   'False
    Text = "frmMain.frx":57E2
    TabIndex = 141
    MultiLine = -1  'True
    ScrollBars = 2
    Locked = -1  'True
  End
  Begin VB.TextBox furni_1
    Left = 3600
    Top = 7680
    Width = 5775
    Height = 4215
    Visible = 0   'False
    Text = "frmMain.frx":910D
    TabIndex = 140
    MultiLine = -1  'True
    ScrollBars = 2
    Locked = -1  'True
  End
  Begin VB.Frame Frame1
    Caption = "HabLog Publicrooms Colors"
    Left = 1920
    Top = 7920
    Width = 4095
    Height = 2415
    TabIndex = 77
    Begin VB.Label pub_name_49
      Caption = "0"
      Left = 3600
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 126
    End
    Begin VB.Label pub_name_1
      Caption = "0"
      Left = 120
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 125
    End
    Begin VB.Label pub_name_2
      Caption = "0"
      Left = 120
      Top = 480
      Width = 375
      Height = 255
      TabIndex = 124
    End
    Begin VB.Label pub_name_3
      Caption = "0"
      Left = 120
      Top = 720
      Width = 375
      Height = 255
      TabIndex = 123
    End
    Begin VB.Label pub_name_4
      Caption = "0"
      Left = 120
      Top = 960
      Width = 375
      Height = 255
      TabIndex = 122
    End
    Begin VB.Label pub_name_5
      Caption = "0"
      Left = 120
      Top = 1200
      Width = 375
      Height = 255
      TabIndex = 121
    End
    Begin VB.Label pub_name_6
      Caption = "0"
      Left = 120
      Top = 1440
      Width = 375
      Height = 255
      TabIndex = 120
    End
    Begin VB.Label pub_name_7
      Caption = "0"
      Left = 120
      Top = 1680
      Width = 375
      Height = 255
      TabIndex = 119
    End
    Begin VB.Label pub_name_8
      Caption = "0"
      Left = 120
      Top = 1920
      Width = 375
      Height = 255
      TabIndex = 118
    End
    Begin VB.Label pub_name_9
      Caption = "0"
      Left = 720
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 117
    End
    Begin VB.Label pub_name_10
      Caption = "0"
      Left = 720
      Top = 480
      Width = 375
      Height = 255
      TabIndex = 116
    End
    Begin VB.Label pub_name_11
      Caption = "0"
      Left = 720
      Top = 720
      Width = 375
      Height = 255
      TabIndex = 115
    End
    Begin VB.Label pub_name_12
      Caption = "0"
      Left = 720
      Top = 960
      Width = 375
      Height = 255
      TabIndex = 114
    End
    Begin VB.Label pub_name_13
      Caption = "0"
      Left = 720
      Top = 1200
      Width = 375
      Height = 255
      TabIndex = 113
    End
    Begin VB.Label pub_name_14
      Caption = "0"
      Left = 720
      Top = 1440
      Width = 375
      Height = 255
      TabIndex = 112
    End
    Begin VB.Label pub_name_15
      Caption = "0"
      Left = 720
      Top = 1680
      Width = 375
      Height = 255
      TabIndex = 111
    End
    Begin VB.Label pub_name_16
      Caption = "0"
      Left = 720
      Top = 1920
      Width = 375
      Height = 255
      TabIndex = 110
    End
    Begin VB.Label pub_name_17
      Caption = "0"
      Left = 1320
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 109
    End
    Begin VB.Label pub_name_18
      Caption = "0"
      Left = 1320
      Top = 480
      Width = 375
      Height = 255
      TabIndex = 108
    End
    Begin VB.Label pub_name_19
      Caption = "0"
      Left = 1320
      Top = 720
      Width = 375
      Height = 255
      TabIndex = 107
    End
    Begin VB.Label pub_name_20
      Caption = "0"
      Left = 1320
      Top = 960
      Width = 375
      Height = 255
      TabIndex = 106
    End
    Begin VB.Label pub_name_21
      Caption = "0"
      Left = 1320
      Top = 1200
      Width = 375
      Height = 255
      TabIndex = 105
    End
    Begin VB.Label pub_name_22
      Caption = "0"
      Left = 1320
      Top = 1440
      Width = 375
      Height = 255
      TabIndex = 104
    End
    Begin VB.Label pub_name_23
      Caption = "0"
      Left = 1320
      Top = 1680
      Width = 375
      Height = 255
      TabIndex = 103
    End
    Begin VB.Label pub_name_24
      Caption = "0"
      Left = 1320
      Top = 1920
      Width = 375
      Height = 255
      TabIndex = 102
    End
    Begin VB.Label pub_name_25
      Caption = "0"
      Left = 1920
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 101
    End
    Begin VB.Label pub_name_26
      Caption = "0"
      Left = 1920
      Top = 480
      Width = 375
      Height = 255
      TabIndex = 100
    End
    Begin VB.Label pub_name_27
      Caption = "0"
      Left = 1920
      Top = 720
      Width = 375
      Height = 255
      TabIndex = 99
    End
    Begin VB.Label pub_name_28
      Caption = "0"
      Left = 1920
      Top = 960
      Width = 375
      Height = 255
      TabIndex = 98
    End
    Begin VB.Label pub_name_29
      Caption = "0"
      Left = 1920
      Top = 1200
      Width = 375
      Height = 255
      TabIndex = 97
    End
    Begin VB.Label pub_name_30
      Caption = "0"
      Left = 1920
      Top = 1440
      Width = 375
      Height = 255
      TabIndex = 96
    End
    Begin VB.Label pub_name_31
      Caption = "0"
      Left = 1920
      Top = 1680
      Width = 375
      Height = 255
      TabIndex = 95
    End
    Begin VB.Label pub_name_32
      Caption = "0"
      Left = 1920
      Top = 1920
      Width = 375
      Height = 255
      TabIndex = 94
    End
    Begin VB.Label pub_name_33
      Caption = "0"
      Left = 2520
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 93
    End
    Begin VB.Label pub_name_34
      Caption = "0"
      Left = 2520
      Top = 480
      Width = 375
      Height = 255
      TabIndex = 92
    End
    Begin VB.Label pub_name_35
      Caption = "0"
      Left = 2520
      Top = 720
      Width = 375
      Height = 255
      TabIndex = 91
    End
    Begin VB.Label pub_name_36
      Caption = "0"
      Left = 2520
      Top = 960
      Width = 375
      Height = 255
      TabIndex = 90
    End
    Begin VB.Label pub_name_37
      Caption = "0"
      Left = 2520
      Top = 1200
      Width = 375
      Height = 255
      TabIndex = 89
    End
    Begin VB.Label pub_name_38
      Caption = "0"
      Left = 2520
      Top = 1440
      Width = 375
      Height = 255
      TabIndex = 88
    End
    Begin VB.Label pub_name_39
      Caption = "0"
      Left = 2520
      Top = 1680
      Width = 375
      Height = 255
      TabIndex = 87
    End
    Begin VB.Label pub_name_40
      Caption = "0"
      Left = 2520
      Top = 1920
      Width = 375
      Height = 255
      TabIndex = 86
    End
    Begin VB.Label pub_name_41
      Caption = "0"
      Left = 3120
      Top = 240
      Width = 375
      Height = 255
      TabIndex = 85
    End
    Begin VB.Label pub_name_42
      Caption = "0"
      Left = 3120
      Top = 480
      Width = 375
      Height = 255
      TabIndex = 84
    End
    Begin VB.Label pub_name_43
      Caption = "0"
      Left = 3120
      Top = 720
      Width = 375
      Height = 255
      TabIndex = 83
    End
    Begin VB.Label pub_name_44
      Caption = "0"
      Left = 3120
      Top = 960
      Width = 375
      Height = 255
      TabIndex = 82
    End
    Begin VB.Label pub_name_45
      Caption = "0"
      Left = 3120
      Top = 1200
      Width = 375
      Height = 255
      TabIndex = 81
    End
    Begin VB.Label pub_name_46
      Caption = "0"
      Left = 3120
      Top = 1440
      Width = 375
      Height = 255
      TabIndex = 80
    End
    Begin VB.Label pub_name_47
      Caption = "0"
      Left = 3120
      Top = 1680
      Width = 375
      Height = 255
      TabIndex = 79
    End
    Begin VB.Label pub_name_48
      Caption = "0"
      Left = 3120
      Top = 1920
      Width = 375
      Height = 255
      TabIndex = 78
    End
  End
End

Attribute VB_Name = "frmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

Option Explicit

' Windows API declarations
Private Declare Function SetWindowPos Lib "user32" (ByVal hwnd As Long, ByVal hWndInsertAfter As Long, ByVal X As Long, ByVal Y As Long, ByVal cx As Long, ByVal cy As Long, ByVal wFlags As Long) As Long
Private Declare Function Shell_NotifyIcon Lib "shell32.dll" Alias "Shell_NotifyIconA" (ByVal dwMessage As Long, lpData As Any) As Long
Private Declare Function GetVersion Lib "kernel32" () As Long
Private Declare Function ExitWindowsEx Lib "user32" (ByVal uFlags As Long, ByVal dwReserved As Long) As Long
Private Declare Function GetLastError Lib "kernel32" () As Long

' Constants
Private Const HWND_TOPMOST = -1
Private Const HWND_NOTOPMOST = -2
Private Const SWP_NOSIZE = &H1
Private Const SWP_NOMOVE = &H2
Private Const SWP_FLAGS = SWP_NOSIZE Or SWP_NOMOVE

' Public form variables
Public SockI As Long
Public BotI As Long
Public SocketQueue As String
Public FreeSockets As String
Public Hpets As String
Public LoadedRollers As String
Public CFHs As Long
Public PickedUpCalls As String
Public DebugActive As Boolean
Public dices As String
Public Wanted As Double

' ============================================================================
' Timer Events
' ============================================================================

Private Sub TimerDrink_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    gUserData(Index).DrinkStatus = True
    gUserData(Index).NeedUpdate = True

ErrorHandler:
    Exit Sub
End Sub

Private Sub Timer2_Timer()
    Dim appPath As String
    Dim habboCount As Variant
    Dim roomCount As Variant
    Dim furniCount As Variant
    Dim tsFile As Object
    Dim checkValue As Integer
    Dim statusText As String

    ' Set database path
    appPath = Replace(App.Path & "\database\", "\", "\\")
    gAppPath = appPath

    ' Read habbo count
    Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\count.txt", 1, False, 0)
    habboCount = Val(tsFile.ReadAll)
    tsFile.Close

    ' Read private rooms count
    Set tsFile = gFSO.OpenTextFile(gAppPath & "privaterooms\count.txt", 1, False, 0)
    roomCount = Val(tsFile.ReadAll)
    tsFile.Close

    ' Read furni count
    Set tsFile = gFSO.OpenTextFile(gAppPath & "furni\count.txt", 1, False, 0)
    furniCount = Val(tsFile.ReadAll)
    tsFile.Close

    ' Update labels with counts
    lblHabboCount.Caption = CStr(habboCount)
    lblRoomCount.Caption = CStr(roomCount)
    lblFurniCount.Caption = CStr(furniCount)

    ' Set timer interval
    Timer2.Interval = 1000

    ' Update user count label
    lblOnlineCount.Caption = CStr(Listuseronline.ListCount)

    ' Update time label
    lblTime.Caption = Format(Time, "hh:mm:ss")

    ' Update date label
    lblDate.Caption = CStr(Now)

    ' Check diving status
    checkValue = chkDiving.Value
    If checkValue = 1 Then
        statusText = "ON"
    ElseIf checkValue = 0 Then
        statusText = "OFF"
    End If
    lblDivingStatus.Caption = statusText

    ' Update revision label
    lblRevision.Caption = "174"

    ' Check debug status
    checkValue = chkDebug.Value
    If checkValue = 1 Then
        statusText = "ON"
    ElseIf checkValue = 0 Then
        statusText = "OFF"
    End If
    lblDebugStatus.Caption = statusText
End Sub

Private Sub Timer4_Timer()
    Timer4.Enabled = False
End Sub

Private Sub TimerVanish_Timer(Index As Integer)
    Dim tagValue As String

    tagValue = TimerVanish(Index).Tag

    If Val(tagValue) = 2 Then
        gUserData(Index).IsVanished = True
        gUserData(Index).VanishVisible = False
        gUserData(Index).VanishStatus = "0"
        TimerVanish(Index).Enabled = False
        TimerVanishUpdate(Index).Enabled = False
        gUserData(Index).NeedUpdate = True
    Else
        TimerVanish(Index).Tag = CStr(Val(tagValue) + 1)
    End If
End Sub

Private Sub tmrLido1_Timer()
    On Error Resume Next
    frmMain.txtLido1.Text = "3"
    tmrLido1.Enabled = False
End Sub

Private Sub tmrLido2_Timer()
    On Error Resume Next
    frmMain.txtLido2.Text = "3"
    tmrLido2.Enabled = False
End Sub

Private Sub tmrRumble1_Timer()
    On Error Resume Next
    frmMain.txtRumble1.Text = "3"
    tmrRumble1.Enabled = False
End Sub

Private Sub tmrRumble2_Timer()
    On Error Resume Next
    frmMain.txtRumble2.Text = "3"
    tmrRumble2.Enabled = False
End Sub

Private Sub TimerVote_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    If gUserData(Index).VoteSwim = True Then
        gUserData(Index).SwimStatus = True
        gUserData(Index).SwimAction = "Swim"
        gUserData(Index).NeedUpdate = True
    ElseIf gUserData(Index).VoteSwim = False And gUserData(Index).VoteWalk = True Then
        gUserData(Index).SwimStatus = False
        gUserData(Index).NeedUpdate = True
        gUserData(Index).SwimAction = "walk"
    End If

    gUserData(Index).VoteSwim = False
    gUserData(Index).VoteWalk = False
    TimerVote(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerDiveGuard_Timer()
    Dim doorMessage As String

    If txtDiveGuard.Text <> "0" Then
        txtDiveGuard.Text = "0"
        txtDiveGuard2.Text = "1"
        doorMessage = Chr(1) & EncodeB64(12) & "AGdoor open"
        Call SendToRoom(doorMessage)
        TimerDiveGuard.Enabled = False
    End If
End Sub

Private Sub tmrLidoCam_Timer()
    Dim randomInterval As Long
    Dim targetCamera As String

    On Error Resume Next

    randomInterval = RandomValue(2500, 4500)
    targetCamera = frmMain.txtLidoCam.Text

    Call SendToRoom(Chr(1) & EncodeB64(36) & "AGcam1 targetcamera " & targetCamera & "")

    tmrLidoCam.Interval = randomInterval
End Sub

Private Sub TimerTeleport1_Timer(Index As Integer)
    Dim furniId As String
    Dim furniName As Variant
    Dim furniRoom As Variant
    Dim tsFile As Object

    On Error GoTo ErrorHandler

    furniId = TimerTeleport1(Index).Tag

    ' Read furni name
    Set tsFile = gFSO.OpenTextFile(gAppPath & "furni\" & furniId & "\name.txt", 1, False, 0)
    furniName = tsFile.ReadAll
    tsFile.Close

    ' Read furni room
    Set tsFile = gFSO.OpenTextFile(gAppPath & "furni\" & furniId & "\inroom.txt", 1, False, 0)
    furniRoom = tsFile.ReadAll
    tsFile.Close

    If furniRoom = gUserData(Index).CurrentRoom Then
        ' User is in same room - teleport
        Call SendToUser(Index, Chr(1) & "AY" & furniId & "/" & gUserData(Index).TeleportDest & "/" & furniName & Chr(1) & _
            "AY" & gUserData(Index).TeleportDest & "/" & gUserData(Index).TeleportDest & "/" & furniName)
        TimerTeleport1(Index).Enabled = False
        TimerTeleport2(Index).Enabled = True
    Else
        ' Different room - show door
        TimerTeleport1(Index).Enabled = False
        Call SendToUser(Index, Chr(1) & "@]" & CStr(gUserData(Index).TeleportId))
        gUserData(Index).IsTeleporting = True
        gUserData(Index).CurrentRoom = furniRoom
    End If

ErrorHandler:
    Exit Sub
End Sub

Private Sub tmrLidoZoom_Timer()
    Dim zoomLevel As Variant
    Dim zoomInterval As Variant

    On Error Resume Next

    zoomLevel = RandomValue(1, 2)
    zoomInterval = RandomValue(1500, 9000)

    Call SendToRoom(Chr(1) & EncodeB64(36) & "AGcam1 setcamera " & CStr(zoomLevel))

    tmrLidoZoom.Interval = zoomInterval
End Sub

Private Sub tmrRumbleCam_Timer()
    Dim randomInterval As Long
    Dim targetCamera As String

    On Error Resume Next

    randomInterval = RandomValue(2500, 4500)
    targetCamera = frmMain.txtRumbleCam.Text

    Call SendToRoom(Chr(1) & EncodeB64(27) & "AGcam1 targetcamera " & targetCamera & "")

    tmrRumbleCam.Interval = randomInterval
End Sub

Private Sub tmrRumbleZoom_Timer()
    Dim zoomLevel As Variant
    Dim zoomInterval As Variant

    On Error Resume Next

    zoomLevel = RandomValue(1, 2)
    zoomInterval = RandomValue(1500, 9000)

    Call SendToRoom(Chr(1) & EncodeB64(27) & "AGcam1 setcamera " & CStr(zoomLevel))

    tmrRumbleZoom.Interval = zoomInterval
End Sub

Private Sub TimerWave_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    gUserData(Index).IsWaving = True
    gUserData(Index).WaveStatus = False
    gUserData(Index).NeedUpdate = True
    TimerWave(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerGesture_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    gUserData(Index).GestureActive = False
    gUserData(Index).NeedUpdate = True
    TimerGesture(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerTalk_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    gUserData(Index).IsTalking = False
    gUserData(Index).NeedUpdate = True
    TimerTalk(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerDC_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Disconnect user after timeout
    Call DisconnectUser(Index)
    TimerDC(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerDice_Timer(Index As Integer)
    Dim diceResult As Integer

    On Error GoTo ErrorHandler

    diceResult = RandomValue(1, 6)
    gUserData(Index).DiceResult = diceResult
    gUserData(Index).DiceRolling = False
    gUserData(Index).NeedUpdate = True
    TimerDice(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub UseTimer_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    gUserData(Index).UsingItem = False
    gUserData(Index).NeedUpdate = True
    UseTimer(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub tmrCloseServer_Timer()
    On Error Resume Next

    Call Shutdown
    tmrCloseServer.Enabled = False
    Unload Me
End Sub

Private Sub timer_automessage_Timer()
    On Error Resume Next

    ' Send automatic message to all users
    Call SendAutoMessage

End Sub

Private Sub tmrRumbleCamUpdate_Timer()
    On Error Resume Next

    ' Update rumble camera position
    Call UpdateRumbleCamera
End Sub

Private Sub tmrLidoCamUpdate_Timer()
    On Error Resume Next

    ' Update lido camera position
    Call UpdateLidoCamera
End Sub

Private Sub RollerTimer_Timer()
    Dim i As Long

    On Error Resume Next

    ' Process all loaded rollers
    For i = 1 To SockI
        If gUserData(i).OnRoller = True Then
            Call ProcessRoller(i)
        End If
    Next i
End Sub

Private Sub timer_poweroff_Timer()
    On Error Resume Next

    Call Shutdown
End Sub

Private Sub Online_Limit_Timer()
    Dim i As Long
    Dim onlineCount As Long

    On Error Resume Next

    onlineCount = 0
    For i = 1 To SockI
        If gUserData(i).IsConnected = True Then
            onlineCount = onlineCount + 1
        End If
    Next i

    ' Update online count display
    lblOnlineCount.Caption = CStr(onlineCount)
End Sub

Private Sub useronline_Timer()
    On Error Resume Next

    ' Refresh online users list
    Call RefreshOnlineUsers
End Sub

Private Sub ConnectionTimer_Timer()
    On Error Resume Next

    ' Check for connection timeouts
    Call CheckConnectionTimeouts
End Sub

Private Sub TimerUpdate_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    If gUserData(Index).NeedUpdate = True Then
        Call SendUserUpdate(Index)
        gUserData(Index).NeedUpdate = False
    End If

ErrorHandler:
    Exit Sub
End Sub

Private Sub UpdateFurni_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    Call UpdateFurniStatus(Index)

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerTeleport2_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Complete teleport animation
    gUserData(Index).TeleportStep = 2
    gUserData(Index).NeedUpdate = True
    TimerTeleport2(Index).Enabled = False
    TimerTeleport3(Index).Enabled = True

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerTeleport3_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Finalize teleport
    gUserData(Index).TeleportStep = 0
    gUserData(Index).IsTeleporting = False
    gUserData(Index).NeedUpdate = True
    TimerTeleport3(Index).Enabled = False

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerLidoVote_Timer()
    On Error Resume Next

    ' Process lido pool voting
    Call ProcessLidoVotes
End Sub

Private Sub TimerBotAction_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Execute bot action
    Call ExecuteBotAction(Index)

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerBotUpdate_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Update bot position and status
    Call UpdateBot(Index)

ErrorHandler:
    Exit Sub
End Sub

Private Sub TimerBotTalk_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Make bot speak
    Call BotSpeak(Index)

ErrorHandler:
    Exit Sub
End Sub

Private Sub PetTimer_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    ' Update pet status
    Call UpdatePet(Index)

ErrorHandler:
    Exit Sub
End Sub

' ============================================================================
' Button Click Handlers
' ============================================================================

Private Sub Check1_Click()
    Dim hwndValue As Long

    On Error Resume Next

    hwndValue = Me.hwnd

    If Check1.Value = 1 Then
        ' Set window to always on top
        SetWindowPos hwndValue, HWND_TOPMOST, 0, 0, 0, 0, SWP_FLAGS
        Call WriteIniSetting(gSettingsFile, "server", "foreground", "Y")
    Else
        ' Remove always on top
        SetWindowPos hwndValue, HWND_NOTOPMOST, 0, 0, 0, 0, SWP_FLAGS
        Call WriteIniSetting(gSettingsFile, "server", "foreground", "N")
    End If
End Sub

Private Sub cmdAutoClose_Click()
    On Error Resume Next

    ' Toggle auto close functionality
    If chkAutoClose.Value = 1 Then
        tmrCloseServer.Enabled = True
    Else
        tmrCloseServer.Enabled = False
    End If
End Sub

Private Sub chkChatlog_Click()
    On Error Resume Next

    If chkChatlog.Value = 1 Then
        Call WriteIniSetting(gSettingsFile, "server", "chatlog", "Y")
    Else
        Call WriteIniSetting(gSettingsFile, "server", "chatlog", "N")
    End If
End Sub

Private Sub chkSaveChatLog_Click()
    On Error Resume Next

    If chkSaveChatLog.Value = 1 Then
        Call WriteIniSetting(gSettingsFile, "server", "savechatlog", "Y")
    Else
        Call WriteIniSetting(gSettingsFile, "server", "savechatlog", "N")
    End If
End Sub

Private Sub chckLog_Click()
    On Error Resume Next

    If chckLog.Value = 1 Then
        Call WriteIniSetting(gSettingsFile, "server", "packetlog", "Y")
    Else
        Call WriteIniSetting(gSettingsFile, "server", "packetlog", "N")
    End If
End Sub

Private Sub chkautoclose_Click()
    Dim autoCloseSettings() As String

    On Error Resume Next

    If chkautoclose.Value = 1 Then
        autoCloseSettings = Split(ReadIniSetting(gAppPath & "configuration\settings.ini", "server", "auto_close"), ",")
        tmrCloseServer.Interval = Val(autoCloseSettings(1)) * 60000
        tmrCloseServer.Enabled = True
    Else
        tmrCloseServer.Enabled = False
    End If
End Sub

Private Sub Command1_Click()
    On Error Resume Next

    ' Manual command execution
    Call ExecuteManualCommand
End Sub

Private Sub Image3_Click()
    On Error Resume Next

    ' Show settings form
    frmSettings.Show vbModal
End Sub

Private Sub Image4_Click()
    On Error Resume Next

    ' Show about/credits form
    frmCredits.Show vbModal
End Sub

Private Sub Image5_Click()
    On Error Resume Next

    ' Minimize to tray
    Me.WindowState = vbMinimized
End Sub

Private Sub Image6_Click()
    On Error Resume Next

    ' Exit application
    Unload Me
End Sub

Private Sub Image7_Click()
    On Error Resume Next

    ' Show help
    frmTabTutorial.Show vbModal
End Sub

Private Sub Image8_Click()
    On Error Resume Next

    ' Open housekeeping
    frmTab_housekeeping_extras3.Show vbModal
End Sub

Private Sub Image9_Click()
    On Error Resume Next

    ' Toggle debug mode
    DebugActive = Not DebugActive
End Sub

Private Sub Image10_Click()
    On Error Resume Next

    ' Refresh server status
    Call RefreshServerStatus
End Sub

' ============================================================================
' Form Events
' ============================================================================

Private Sub Form_Load()
    Dim versionInfo As Long
    Dim settingValue As String
    Dim langValue As String
    Dim autoCloseSettings() As String
    Dim pubFolder As Object
    Dim subFolders As Object
    Dim folder As Object
    Dim dataIniPath As String
    Dim botEnabled As String

    On Error Resume Next

    frmFirstRun.loading.Caption = "Initializing interface..."

    Wanted = 1
    DoEvents

    ' Check Windows version
    versionInfo = GetVersion()
    If (versionInfo And &H80000000) = 0 Then
        gIsWinNT = 1
    Else
        gIsWinNT = 0
    End If

    ' Set settings file path
    gSettingsFile = Replace(App.Path & "\database\configuration\settings.ini", "\", "\\")

    ' Set database path
    gAppPath = Replace(App.Path & "\database\", "\", "\\")

    DoEvents

    ' Check if settings file exists
    If FileExists(gSettingsFile) = False Then
        MsgBox "The file settings.ini is missing. HabLog Project will abort now.", vbCritical, "HabLog Project"
        End
    End If

    ' Check for update version
    settingValue = ReadIniSetting(gSettingsFile, "server", "update")
    If settingValue <> "3.2" Then
        Load frmUpdate
        Unload frmUpdate
        Call WriteIniSetting(gSettingsFile, "server", "update", "3.2")
    End If

    frmFirstRun.loading.Caption = "Loading locales..."

    ' Load packet log setting
    settingValue = ReadIniSetting(gSettingsFile, "server", "packetlog")
    If settingValue = "Y" Then
        frmMain.chckLog.Value = 1
    Else
        frmMain.chckLog.Value = 0
    End If

    ' Load chat log setting
    settingValue = ReadIniSetting(gSettingsFile, "server", "chatlog")
    If settingValue = "Y" Then
        frmMain.chkChatlog.Value = 1
    Else
        frmMain.chkChatlog.Value = 0
    End If

    ' Load save chat log setting
    settingValue = ReadIniSetting(gSettingsFile, "server", "savechatlog")
    If settingValue = "Y" Then
        frmMain.chkSaveChatLog.Value = 1
    Else
        frmMain.chkSaveChatLog.Value = 0
    End If

    ' Load foreground setting
    settingValue = ReadIniSetting(gSettingsFile, "server", "foreground")
    If settingValue = "Y" Then
        frmMain.Check1.Value = 1
        SetWindowPos Me.hwnd, HWND_TOPMOST, 0, 0, 0, 0, SWP_FLAGS
    Else
        frmMain.Check1.Value = 0
        SetWindowPos Me.hwnd, HWND_NOTOPMOST, 0, 0, 0, 0, SWP_FLAGS
    End If

    ' Load auto close setting
    settingValue = ReadIniSetting(gAppPath & "configuration\settings.ini", "server", "auto_close")
    autoCloseSettings = Split(settingValue, ",")
    If autoCloseSettings(0) = "1" Then
        chkautoclose.Value = 1
        tmrCloseServer.Enabled = True
    Else
        chkautoclose.Value = 0
        tmrCloseServer.Enabled = False
    End If

    ' Load diving setting
    settingValue = ReadIniSetting(gSettingsFile, "config", "diving")
    If settingValue = "1" Then
        frmMain.chkDiving.Value = 1
    ElseIf settingValue = "0" Then
        frmMain.chkDiving.Value = 0
        frmMain.txtDiveGuard.Text = "0"
    End If

    DoEvents

    ' Load language setting
    langValue = ReadIniSetting(gSettingsFile, "server", "lang")
    Select Case langValue
        Case "DE"
            mnuLangDE.Checked = True
        Case "US"
            mnuLangUS.Checked = True
        Case "SE"
            mnuLangSE.Checked = True
        Case "NL"
            mnuLangNL.Checked = True
        Case "FR"
            mnuLangFR.Checked = True
        Case "ES"
            mnuLangES.Checked = True
        Case "IT"
            mnuLangIT.Checked = True
        Case "PT"
            mnuLangPT.Checked = True
        Case "EXTRA"
            mnuLangExtra.Checked = True
    End Select

    ' Load locale strings
    Call LoadLocale

    ' Initialize room data array
    ReDim gRoomData(0 To 0)

    frmFirstRun.loading.Caption = "Loading public rooms + bots..."
    DoEvents

    ' Load public rooms and bots
    Set pubFolder = gFSO.GetFolder(gAppPath & "pub")
    Set subFolders = pubFolder.SubFolders

    For Each folder In subFolders
        dataIniPath = folder.Path & "\data.ini"

        If IsNumeric(Dir(folder, vbDirectory)) And gFSO.FileExists(dataIniPath) Then
            ' Check if bot is enabled
            botEnabled = ReadIniSetting(dataIniPath, "bot", "enabled")

            If botEnabled = "1" Then
                ' Load bot data
                BotI = BotI + 1
                ReDim Preserve gBotData(0 To BotI)

                gBotData(BotI).RoomId = 0
                gBotData(BotI).IsEnabled = CInt(Dir(folder, vbDirectory))
                gBotData(BotI).Name = ReadIniSetting(dataIniPath, "bot", "name")
                gBotData(BotI).Mission = ReadIniSetting(dataIniPath, "bot", "mission")
                gBotData(BotI).Figure = ReadIniSetting(dataIniPath, "bot", "figure")
                gBotData(BotI).Look = ReadIniSetting(dataIniPath, "bot", "look")
                gBotData(BotI).Sex = gBotData(BotI).Look

                ' Parse walkspace coordinates
                Dim walkSpace() As String
                Dim coordParts() As String
                walkSpace = Split(ReadIniSetting(dataIniPath, "bot", "walkspace"), ",")
                coordParts = Split(CStr(walkSpace(0)), " ")
                gBotData(BotI).StartX = CSng(coordParts(0))

                coordParts = Split(CStr(walkSpace(1)), " ")
                gBotData(BotI).StartY = CSng(coordParts(0))

                gBotData(BotI).CurrentX = gBotData(BotI).StartX
                gBotData(BotI).CurrentY = gBotData(BotI).StartY

                ' Load heightmap
                Dim tsFile As Object
                Dim heightmapData As String
                Dim heightmapRows() As String

                Set tsFile = gFSO.OpenTextFile(folder.Path & "\heightmap.map", 1, False, 0)
                heightmapData = tsFile.ReadAll
                tsFile.Close

                heightmapRows = Split(heightmapData, Chr(13))
                gBotData(BotI).Heightmap = Mid(heightmapRows(CLng(gBotData(BotI).StartX) + 1), CLng(gBotData(BotI).StartY) + 1, 1)
            End If
        End If
    Next folder

    DoEvents

    ' Show main form
    Me.Show
    Me.Refresh

    ' Setup system tray icon
    Call SetupTrayIcon

    SocketQueue = ""

    On Error GoTo SocketError

    ' Check agreement status
    settingValue = ReadIniSetting(gSettingsFile, "server", "agree")

    If settingValue = "yes" Then
        ' Start listening socket
        Dim portValue As Long
        portValue = Val(ReadIniSetting(gSettingsFile, "server", "port"))
        Sock(0).LocalPort = portValue
        Sock(0).Listen

        ' Update status text
        txtLog.Text = txtLog.Text & "[0] -- " & GetLocaleString("server_started_msg") & " " & CStr(Sock(0).LocalPort)
        txtLog.Text = txtLog.Text & "[0] -- " & GetLocaleString("server_started_msg") & " " & CStr(Sock(0).LocalPort)
    Else
        ' Show agreement form
        frmAgree.Show vbModal
    End If

    Exit Sub

SocketError:
    Dim errorMsg As String
    errorMsg = GetLocaleString("socket_error")
    MsgBox errorMsg & vbCrLf & vbCrLf & "--------" & vbCrLf & vbCrLf & Err.Description, vbCritical, "HabLog Project"
    End
End Sub

Private Sub Form_Resize()
    On Error Resume Next

    If Me.WindowState = vbMinimized Then
        Me.Hide
    End If
End Sub

Private Sub Form_Unload(Cancel As Integer)
    Dim logDate As String
    Dim logPath As String
    Dim tsFile As Object

    On Error Resume Next

    ' Remove tray icon
    Call RemoveTrayIcon

    ' Save chat log if enabled
    If chkSaveChatLog.Value = 1 Then
        logDate = Replace(CStr(Date), "-", "/")

        ' Create chatlogs folder if needed
        If gFSO.FolderExists(App.Path & "\chatlogs") = False Then
            gFSO.CreateFolder App.Path & "\chatlogs"
        End If

        logPath = App.Path & "\chatlogs\" & logDate & ".log"

        ' Create log file if needed
        If gFSO.FileExists(logPath) = False Then
            gFSO.CreateTextFile logPath, True, False

            ' Write date header
            Set tsFile = gFSO.OpenTextFile(logPath, 2, False, 0)
            tsFile.Write "DATE: " & CStr(Date) & "" & vbCrLf
            tsFile.Close
        End If

        ' Append chat log
        Set tsFile = gFSO.OpenTextFile(logPath, 8, False, 0)
        tsFile.Write chatLog.Text & vbCrLf
        tsFile.Close

        End
    End If

    ' Unload all forms
    Unload frmMain
    Unload frmFirstRun
    Unload frmSettings
    Unload frmCredits
    Unload frmUpdate
    Unload frmBan
    Unload frmAlert
    Unload frmAgree
    Unload frmWelcome
    Unload frmLoaderGenerator
    Unload frmTab_housekeeping_extras3
End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
    On Error Resume Next

    ' Handle keyboard shortcuts
    Select Case KeyCode
        Case vbKeyF1
            ' Show help
            frmTabTutorial.Show vbModal
        Case vbKeyF5
            ' Refresh
            Call RefreshServerStatus
        Case vbKeyEscape
            ' Minimize
            Me.WindowState = vbMinimized
    End Select
End Sub

Private Sub Form_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    ' Handle mouse movement for drag functionality
End Sub

' ============================================================================
' Text/List Events
' ============================================================================

Private Sub chatLog_Change()
    On Error Resume Next

    ' Auto-scroll to bottom
    chatLog.SelStart = Len(chatLog.Text)
End Sub

Private Sub txtLog_Change()
    On Error Resume Next

    ' Auto-scroll to bottom
    txtLog.SelStart = Len(txtLog.Text)
End Sub

Private Sub Picture1_KeyDown(KeyCode As Integer, Shift As Integer)
    On Error Resume Next

    ' Handle key presses in picture box
End Sub

Private Sub Listuseronline_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    If Button = vbRightButton Then
        ' Show context menu for user
        PopupMenu mnuUserContext
    End If
End Sub

Private Sub cas_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    ' Handle mouse down on cas control
End Sub

Private Sub Text2_KeyDown(KeyCode As Integer, Shift As Integer)
    On Error Resume Next

    If KeyCode = vbKeyReturn Then
        ' Execute command
        Call ExecuteManualCommand
    End If
End Sub

Private Sub Text3_Change()
    On Error Resume Next

    ' Handle search text change
End Sub

' ============================================================================
' Property Get/Let procedures
' ============================================================================

Public Function SockIGet() As Long
    SockIGet = SockI
End Function

Public Sub SockIPut(Value As Long)
    SockI = Value
End Sub

Public Function BotIGet() As Long
    BotIGet = BotI
End Function

Public Sub BotIPut(Value As Long)
    BotI = Value
End Sub

Public Function SocketQueueGet() As String
    SocketQueueGet = SocketQueue
End Function

Public Sub SocketQueuePut(Value As String)
    SocketQueue = Value
End Sub

Public Function FreeSocketsGet() As String
    FreeSocketsGet = FreeSockets
End Function

Public Sub FreeSocketsPut(Value As String)
    FreeSockets = Value
End Sub

Public Function HpetsGet() As String
    HpetsGet = Hpets
End Function

Public Sub HpetsPut(Value As String)
    Hpets = Value
End Sub

Public Function LoadedRollersGet() As String
    LoadedRollersGet = LoadedRollers
End Function

Public Sub LoadedRollersPut(Value As String)
    LoadedRollers = Value
End Sub

Public Function CFHsGet() As Long
    CFHsGet = CFHs
End Function

Public Sub CFHsPut(Value As Long)
    CFHs = Value
End Sub

Public Function PickedUpCallsGet() As String
    PickedUpCallsGet = PickedUpCalls
End Function

Public Sub PickedUpCallsPut(Value As String)
    PickedUpCalls = Value
End Sub

Public Function DebugActiveGet() As Boolean
    DebugActiveGet = DebugActive
End Function

Public Sub DebugActivePut(Value As Boolean)
    DebugActive = Value
End Sub

Public Function dicesGet() As String
    dicesGet = dices
End Function

Public Sub dicesPut(Value As String)
    dices = Value
End Sub

Public Function WantedGet() As Double
    WantedGet = Wanted
End Function

Public Sub WantedPut(Value As Double)
    Wanted = Value
End Sub

' ============================================================================
' Public Helper Functions
' ============================================================================

Public Sub DoTimer(Index As Long)
    Call TimerTeleport1_Timer(CInt(Index))
End Sub

Public Function RandomValue(Low As Long, High As Long) As Long
    Dim rndValue As Single

    rndValue = Rnd()
    RandomValue = Int((High - Low + 1) * rndValue + Low)
End Function

Public Sub Shutdown()
    On Error Resume Next

    If gIsWinNT = 1 Then
        Call PrepareShutdown

        If gShutdownPrivilege <> 0 Then
            MsgBox "Post-AdjustToken's GetLastError " & CStr(GetLastError()), vbCritical
        End If

        ExitWindowsEx -1, 8

        If gShutdownPrivilege <> 0 Then
            MsgBox "ExitWindowsEx's GetLastError " & CStr(GetLastError()), vbCritical
        End If
    End If
End Sub

Public Function Hab_Color(info As Variant, Index As Long) As String
    Dim i As Long
    Dim colorCount As Long

    On Error Resume Next

    ' Reset all pub_name labels
    pub_name_1.Caption = "0"

    ' Count users in room 1
    For i = 1 To frmMain.SockI
        If gUserData(i).RoomType > 0 Then
            If gUserData(i).RoomType = 1 Then
                colorCount = Val(pub_name_1.Caption) + 1
                pub_name_1.Caption = CStr(colorCount)
            End If
        End If
    Next i

    ' Count users in room 2
    pub_name_2.Caption = "0"
    For i = 1 To frmMain.SockI
        If gUserData(i).RoomType > 0 Then
            If gUserData(i).RoomType = 2 Then
                colorCount = Val(pub_name_2.Caption) + 1
                pub_name_2.Caption = CStr(colorCount)
            End If
        End If
    Next i

    ' Continue for other rooms (3-49)...
    ' Similar pattern for pub_name_3 through pub_name_49

    Hab_Color = ""
End Function

' ============================================================================
' Image4_Click - Send broadcast message to users based on option selection
' ============================================================================

Private Sub Image4_Click()
    Dim i As Variant
    Dim checkValue As Integer
    Dim startTime As Variant
    Dim elapsed As Variant
    Dim msgPacket As String

    On Error Resume Next

    ' Check optAll (send to all users)
    checkValue = optAll.Value
    If checkValue = True Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                msgPacket = "BK" & txtBroadcast.Text & Chr$(1)
                frmMain.Sock(CInt(i)).SendData msgPacket
            End If
        Next i

        ' Wait loop with DoEvents
        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
        Exit Sub
    End If

    ' Check optAdmins (send to admins only)
    checkValue = optAdmins.Value
    If checkValue = True Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                If gUserData(CLng(i)).Rank = "admin" Then
                    msgPacket = "BK" & txtBroadcast.Text & Chr$(1)
                    frmMain.Sock(CInt(i)).SendData msgPacket
                End If
            End If
        Next i

        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
        Exit Sub
    End If

    ' Check optModerators (send to moderators only)
    checkValue = optModerators.Value
    If checkValue = True Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                If gUserData(CLng(i)).Rank = "moderator" Then
                    msgPacket = "BK" & txtBroadcast.Text & Chr$(1)
                    frmMain.Sock(CInt(i)).SendData msgPacket
                End If
            End If
        Next i

        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
        Exit Sub
    End If

    ' Check optHabbox (send to habbox users only)
    checkValue = optHabbox.Value
    If checkValue = True Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                If gUserData(CLng(i)).Rank = "habbox" Then
                    msgPacket = "BK" & txtBroadcast.Text & Chr$(1)
                    frmMain.Sock(CInt(i)).SendData msgPacket
                End If
            End If
        Next i

        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
        Exit Sub
    End If

    ' Check optManagers (send to managers only)
    checkValue = optManagers.Value
    If checkValue = True Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                If gUserData(CLng(i)).Rank = "manager" Then
                    msgPacket = "BK" & txtBroadcast.Text & Chr$(1)
                    frmMain.Sock(CInt(i)).SendData msgPacket
                End If
            End If
        Next i

        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
        Exit Sub
    End If

    ' Check optStaff (send to all staff - admin, manager, habbox, moderator)
    checkValue = optStaff.Value
    If checkValue = True Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                If gUserData(CLng(i)).Rank = "admin" Or _
                   gUserData(CLng(i)).Rank = "manager" Or _
                   gUserData(CLng(i)).Rank = "habbox" Or _
                   gUserData(CLng(i)).Rank = "moderator" Then
                    msgPacket = "BK" & txtBroadcast.Text & Chr$(1)
                    frmMain.Sock(CInt(i)).SendData msgPacket
                End If
            End If
        Next i

        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
    End If
End Sub

' ============================================================================
' Image3_Click - Add credits to users
' ============================================================================

Private Sub Image3_Click()
    Dim i As Variant
    Dim creditsToAdd As String
    Dim currentCredits As Variant
    Dim newCredits As Double
    Dim tsFile As Object
    Dim usernameLower As String
    Dim transactionLog As String
    Dim dateStr As String

    On Error Resume Next

    ' Check if credits text is numeric
    If IsNumeric(txtCreditsAmount.Text) = False Then
        Exit Sub
    End If

    creditsToAdd = txtCreditsAmount.Text

    ' Check if optSingle is selected (add to all connected users) and optDatabase is not
    If optSingle.Value = True And optDatabase.Value = False Then
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 Then
                ' Get lowercase username
                usernameLower = LCase(gUserData(CLng(i)).Username)

                ' Read current credits
                Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & usernameLower & "\credits.txt", 1, False, 0)
                currentCredits = tsFile.ReadAll
                tsFile.Close

                ' Calculate new credits
                newCredits = Val(creditsToAdd) + Val(CStr(currentCredits))

                ' Write new credits
                Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & usernameLower & "\credits.txt", 2, False, 0)
                tsFile.Write CStr(newCredits)
                tsFile.Close

                ' Create transaction log entry
                dateStr = Replace(CStr(Date), "-", ".")
                transactionLog = dateStr & Chr$(9) & CStr(Time) & Chr$(9) & creditsToAdd & Chr$(9) & "0" & Chr$(9) & Chr$(9) & "web_internal" & Chr$(13)

                ' Append to transactions file
                Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & gUserData(CLng(i)).Username & "\transactions.txt", 8, True, 0)
                tsFile.Write transactionLog
                tsFile.Close

                ' Send credits update packet to user
                Call SendData(CInt(i), "@F" & CStr(newCredits) & ".0" & Chr$(1))
            End If
        Next i
        Exit Sub
    End If

    ' Check if optDatabase is selected (add to all users in database)
    If optSingle.Value = False And optDatabase.Value = True Then
        Dim habboFolder As Object
        Dim subFolders As Object
        Dim folder As Object

        Set habboFolder = gFSO.GetFolder(gAppPath & "habbos")
        Set subFolders = habboFolder.SubFolders

        For Each folder In subFolders
            ' Read current credits for each user
            Set tsFile = gFSO.OpenTextFile(folder.Path & "\credits.txt", 1, False, 0)
            currentCredits = tsFile.ReadAll
            tsFile.Close

            ' Calculate new credits
            newCredits = Val(creditsToAdd) + Val(CStr(currentCredits))

            ' Write new credits
            Set tsFile = gFSO.OpenTextFile(folder.Path & "\credits.txt", 2, False, 0)
            tsFile.Write CStr(newCredits)
            tsFile.Close
        Next folder
    End If
End Sub

' ============================================================================
' TimerBotAction_Timer - Handle bot actions (talking, walking)
' ============================================================================

Private Sub TimerBotAction_Timer(Index As Integer)
    Dim i As Variant
    Dim randomAction As Variant
    Dim retryCount As Variant
    Dim talkSetting As Variant
    Dim talkData() As String
    Dim randomTalk As Variant
    Dim talkType As Variant
    Dim walkSpace As String
    Dim walkCoords() As String
    Dim randomCoord As Variant
    Dim coordParts() As String
    Dim tsFile As Object
    Dim iniPath As String
    Dim botRoomSlot As String

    On Error Resume Next

    ' Check if bot is disabled
    If gBotData(Index).IsDisabled = True Then
        gBotData(Index).IsDisabled = False
        Exit Sub
    End If

    ' Find a user in the same room as the bot
    For i = 1 To frmMain.SockI
        If frmMain.Sock(CInt(i)).State = 7 Then
            If gUserData(CLng(i)).PublicRoomId = gBotData(Index).RoomId Then
                Exit For
            End If
        End If
    Next i

    If CLng(i) > frmMain.SockI Then
        Exit Sub
    End If

    ' Randomize action (1 = talk, 2 = walk)
    Randomize
    randomAction = Int(2 * Rnd() + 1)

    If randomAction = 1 Then
        ' Talk action
        retryCount = 0

        Do
            Randomize
            randomTalk = Int(7 * Rnd() + 1)

            ' Get talk setting from INI
            iniPath = gAppPath & "pub\" & CStr(gBotData(Index).RoomId) & "\data.ini"
            talkSetting = GetINI("bot", "talk" & CStr(randomTalk), iniPath)

            If talkSetting <> "0" And talkSetting <> "" Then
                ' Parse talk data
                If InStr(1, CStr(talkSetting), Chr$(2)) = 0 Then
                    talkSetting = "say" & Chr$(2) & talkSetting
                End If

                talkData = Split(CStr(talkSetting), Chr$(2))

                If talkData(0) = "say" Then
                    ' Send say message to all users in room
                    For i = 1 To frmMain.SockI
                        If frmMain.Sock(CInt(i)).State = 7 And _
                           gUserData(CLng(i)).PublicRoomId = gBotData(Index).RoomId And _
                           GetDistance(gBotData(Index).CurrentX, gUserData(CLng(i)).PosX) < 8 And _
                           GetDistance(gBotData(Index).CurrentY, gUserData(CLng(i)).PosY) < 8 Then

                            botRoomSlot = EncodeVL64(gBotData(Index).RoomSlot)
                            Call SendData(CInt(i), Chr$(2) & "@X" & botRoomSlot & talkData(1) & Chr$(2) & Chr$(1))
                        End If
                    Next i
                Else
                    ' Send shout message to room
                    botRoomSlot = EncodeVL64(gBotData(Index).RoomSlot)
                    Call SendToPublicRoom(gBotData(Index).RoomId, "@Z" & botRoomSlot & talkData(1) & Chr$(2) & Chr$(1))
                End If

                ' Set talk timer interval based on message length
                Dim talkInterval As Long
                talkInterval = Len(CStr(talkSetting)) * 100
                If talkInterval < 500 Then talkInterval = 500

                gBotData(Index).IsTalking = True
                TimerBotAction(Index).Interval = talkInterval
                TimerBotAction(Index).Enabled = True
                gBotData(Index).NeedUpdate = True
                Exit Sub
            End If

            retryCount = retryCount + 1
            If retryCount >= 20 Then Exit Sub
        Loop
    Else
        ' Walk action
        retryCount = 0

        ' Get walkspace from INI
        iniPath = gAppPath & "pub\" & CStr(gBotData(Index).RoomId) & "\data.ini"
        walkSpace = GetINI("bot", "walkspace", iniPath)
        walkCoords = Split(walkSpace, ",")

        Do
            Randomize
            randomCoord = Int((UBound(walkCoords) - 1 + 1) * Rnd() + 1)

            ' Check if coordinate is valid
            If InStr(1, CStr(walkCoords(CLng(randomCoord))), " ") <> 0 Then
                coordParts = Split(CStr(walkCoords(CLng(randomCoord))), " ")

                If IsNumeric(coordParts(0)) And IsNumeric(coordParts(1)) Then
                    ' Set new target position
                    gBotData(Index).TargetX = CSng(coordParts(0))
                    gBotData(Index).TargetY = CSng(coordParts(1))
                    gBotData(Index).NeedUpdate = True
                    Exit Sub
                End If
            End If

            retryCount = retryCount + 1
            If retryCount >= 20 Then Exit Sub
        Loop
    End If
End Sub

' ============================================================================
' Timer3_Timer - Update user data from filesystem
' ============================================================================

Private Sub Timer3_Timer()
    Dim i As Variant
    Dim appPathTemp As String
    Dim updateFilePath As String
    Dim tsFile As Object
    Dim userData As Variant
    Dim userSex As Variant
    Dim userMission As Variant
    Dim userSlot As Variant
    Dim userFigure As String
    Dim roomPacket As String
    Dim j As Long

    On Error Resume Next

    ' Set database path
    appPathTemp = Replace(App.Path & "\database\", "\", "\\")
    gAppPath = appPathTemp

    ' Loop through all connected users
    For i = 1 To frmMain.SockI
        ' Check if update file exists for user
        updateFilePath = gAppPath & "update\" & gUserData(CLng(i)).Username & ".update"

        If gFSO.FileExists(updateFilePath) = True Then
            ' Delete update file
            gFSO.DeleteFile updateFilePath, False

            ' Read user appearance data
            Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & gUserData(CLng(i)).Username & "\app.txt", 1, False, 0)
            userData = tsFile.ReadAll
            tsFile.Close
            gUserData(CLng(i)).Appearance = CStr(userData)

            ' Read user sex
            Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & gUserData(CLng(i)).Username & "\sex.txt", 1, False, 0)
            userSex = tsFile.ReadAll
            tsFile.Close

            ' Read user mission
            Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & gUserData(CLng(i)).Username & "\mission.txt", 1, False, 0)
            userMission = tsFile.ReadAll
            tsFile.Close

            ' Get user room slot
            userSlot = gUserData(CLng(i)).RoomSlot

            ' Clean up figure string (remove control characters)
            userFigure = gUserData(CLng(i)).Figure
            For j = 1 To 13
                userFigure = Replace(userFigure, Chr$(j), "")
            Next j
            gUserData(CLng(i)).Figure = userFigure

            ' Store mission and sex
            gUserData(CLng(i)).Mission = CStr(userMission)
            gUserData(CLng(i)).Sex = CStr(userSex)

            ' Send update packet to room if user is in a private room
            If gUserData(CLng(i)).RoomId > 0 Then
                roomPacket = "DJ" & EncodeVL64(CSng(userSlot)) & CStr(userData) & "" & CStr(userSex) & "" & CStr(userMission) & ""
                Call RemoveUserFromRoom(CLng(gUserData(CLng(i)).RoomId), roomPacket)
            End If

            ' Send update packet if user is in a public room
            If gUserData(CLng(i)).PublicRoomId > 0 Then
                roomPacket = "DJ" & EncodeVL64(CSng(userSlot)) & CStr(userData) & "" & CStr(userSex) & "" & CStr(userMission) & ""
                Call SendToPublicRoom(CInt(gUserData(CLng(i)).PublicRoomId), roomPacket)
            End If
        End If
    Next i

    ' Check chkUpdateAll for sending figure updates to all users
    If chkUpdateAll.Value = 1 Then
        Dim figurePacket As String
        Dim startTime As Variant
        Dim elapsed As Variant

        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                figurePacket = "Dj" & EncodeVL64(Val(lblFigureId.Caption)) & Chr$(1)
                frmMain.Sock(CInt(i)).SendData figurePacket
            End If
        Next i

        startTime = Timer
        Do
            DoEvents
            elapsed = Timer - startTime
        Loop Until elapsed >= 2
    End If
End Sub

' ============================================================================
' timer_automessage_Timer - Send automatic scheduled messages
' ============================================================================

Private Sub timer_automessage_Timer()
    Dim i As Variant
    Dim currentTime As Variant
    Dim scheduledTime As String
    Dim autoMessage As String
    Dim messageParts() As String
    Dim msgPacket As String

    On Error Resume Next

    ' Get current time and scheduled time
    currentTime = Time
    scheduledTime = frmAutoClose.timemessage.Caption

    ' Check if current time matches scheduled time
    If Format(currentTime, "hh/mm/ss") = scheduledTime Then
        ' Get auto close message from settings
        autoMessage = GetINI("server", "auto_close_message", gSettingsFile)
        messageParts = Split(autoMessage, ",")

        ' Send message to all connected users
        For i = 1 To frmMain.SockI
            If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
                msgPacket = "BK" & messageParts(1) & Chr$(1)
                frmMain.Sock(CInt(i)).SendData msgPacket
            End If
        Next i
    End If
End Sub

' ============================================================================
' tmrCloseServer_Timer - Server shutdown handler
' ============================================================================

Private Sub tmrCloseServer_Timer()
    Dim i As Variant
    Dim shutdownMsg As String

    On Error Resume Next

    ' Send shutdown message to all connected users
    For i = 1 To frmMain.SockI
        If frmMain.Sock(CInt(i)).State = 7 Then
            shutdownMsg = "BKHotel stats: OFFLINE" & Chr$(1)
            frmMain.Sock(CInt(i)).SendData shutdownMsg
        End If
    Next i

    ' End the application
    End
End Sub

' ============================================================================
' cas_MouseDown - Handle form dragging (borderless window)
' ============================================================================

Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" _
    (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As Any) As Long
Private Declare Function ReleaseCapture Lib "user32" () As Long

Private Const WM_NCLBUTTONDOWN As Long = &HA1
Private Const HTCAPTION As Long = 2

Private Sub cas_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    If Button = 1 Then
        ' Left button - drag form
        ReleaseCapture
        SendMessage Me.hwnd, WM_NCLBUTTONDOWN, HTCAPTION, 0&
    Else
        ' Right button - close form
        Unload Me
    End If
End Sub

' ============================================================================
' Listuseronline_MouseDown - Show context menu for online users
' ============================================================================

Private Sub Listuseronline_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    On Error Resume Next

    If frmMain.Listuseronline.Text <> "" Then
        If Button = 2 Then
            ' Right-click - show popup menu
            PopupMenu frmLoaderGenerator.mnuuseronline
        End If
    End If
End Sub

' ============================================================================
' RollerTimer_Timer - Process room rollers
' ============================================================================

Private Sub RollerTimer_Timer()
    Dim i As Variant
    Dim j As Variant
    Dim rollerList() As String
    Dim rollerParts() As String
    Dim rollerX As Single
    Dim rollerY As Single
    Dim rollerDir As Integer
    Dim newX As Single
    Dim newY As Single
    Dim rollerPacket As String
    Dim tsFile As Object

    On Error Resume Next

    ' Check if there are any loaded rollers
    If LoadedRollers = "" Then Exit Sub

    ' Split roller list
    rollerList = Split(LoadedRollers, ",")

    ' Process each roller
    For i = 0 To UBound(rollerList)
        If rollerList(i) <> "" Then
            rollerParts = Split(rollerList(i), " ")

            If UBound(rollerParts) >= 2 Then
                rollerX = CSng(rollerParts(0))
                rollerY = CSng(rollerParts(1))
                rollerDir = CInt(rollerParts(2))

                ' Calculate new position based on direction
                Select Case rollerDir
                    Case 0: newY = rollerY - 1: newX = rollerX
                    Case 2: newX = rollerX + 1: newY = rollerY
                    Case 4: newY = rollerY + 1: newX = rollerX
                    Case 6: newX = rollerX - 1: newY = rollerY
                End Select

                ' Check for users on the roller and move them
                For j = 1 To frmMain.SockI
                    If frmMain.Sock(CInt(j)).State = 7 Then
                        If gUserData(CLng(j)).PosX = rollerX And gUserData(CLng(j)).PosY = rollerY Then
                            ' User is on this roller - move them
                            gUserData(CLng(j)).TargetX = newX
                            gUserData(CLng(j)).TargetY = newY
                            gUserData(CLng(j)).OnRoller = True
                            gUserData(CLng(j)).NeedUpdate = True
                        End If
                    End If
                Next j
            End If
        End If
    Next i
End Sub

' ============================================================================
' TimerVanishUpdate_Timer - Update vanished user status
' ============================================================================

Private Sub TimerVanishUpdate_Timer(Index As Integer)
    On Error Resume Next

    If gUserData(Index).IsVanished = True Then
        gUserData(Index).NeedUpdate = True
    End If
End Sub

' ============================================================================
' Private Helper Functions
' ============================================================================

Private Sub SetupTrayIcon()
    ' Setup system tray icon - implemented in modIcon if available
End Sub

Private Sub RemoveTrayIcon()
    ' Remove system tray icon - implemented in modIcon if available
End Sub

Private Sub RefreshServerStatus()
    ' Refresh server status display
    On Error Resume Next
    Timer2_Timer
End Sub

Private Sub RefreshOnlineUsers()
    ' Refresh the online users list
    Dim i As Variant

    On Error Resume Next

    Listuseronline.Clear

    For i = 1 To frmMain.SockI
        If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
            Listuseronline.AddItem gUserData(CLng(i)).Username
        End If
    Next i
End Sub

Private Sub CheckConnectionTimeouts()
    ' Check and handle connection timeouts
    Dim i As Variant

    On Error Resume Next

    For i = 1 To frmMain.SockI
        If gUserData(CLng(i)).LastActivity > 0 Then
            If Timer - gUserData(CLng(i)).LastActivity > 300 Then
                ' 5 minute timeout - disconnect user
                frmMain.Sock(CInt(i)).Close
            End If
        End If
    Next i
End Sub

Private Sub ExecuteManualCommand()
    ' Execute manual console command from Text2
    Dim cmdText As String

    On Error Resume Next

    cmdText = Text2.Text

    If cmdText <> "" Then
        ' Process command
        txtLog.Text = txtLog.Text & vbCrLf & "[CMD] " & cmdText
        Text2.Text = ""
    End If
End Sub

Private Sub SendAutoMessage()
    ' Send automatic server message - called by timer_automessage_Timer
    Call timer_automessage_Timer
End Sub

Private Sub UpdateRumbleCamera()
    ' Update rumble pool camera position
    Dim randomTarget As Long

    On Error Resume Next

    Randomize
    randomTarget = Int(5 * Rnd() + 1)
    frmMain.txtRumbleCam.Text = CStr(randomTarget)
End Sub

Private Sub UpdateLidoCamera()
    ' Update lido pool camera position
    Dim randomTarget As Long

    On Error Resume Next

    Randomize
    randomTarget = Int(5 * Rnd() + 1)
    frmMain.txtLidoCam.Text = CStr(randomTarget)
End Sub

Private Sub ProcessLidoVotes()
    ' Process lido pool diving votes
    ' Implementation depends on diving competition state
End Sub

Private Sub PrepareShutdown()
    ' Prepare system for shutdown - calls modPowerOff functions
    On Error Resume Next
    Call EnableShutdownPrivilege
End Sub

Private Function GetDistance(pos1 As Double, pos2 As Double) As Double
    GetDistance = Abs(pos1 - pos2)
End Function

' ============================================================================
' timer_poweroff_Timer - Handle automatic server shutdown/poweroff
' ============================================================================

Private Sub timer_poweroff_Timer()
    Dim currentTime As Variant
    Dim scheduledTime As String
    Dim poweroffPC As Integer

    On Error Resume Next

    ' Get current time and scheduled shutdown time
    currentTime = Time
    scheduledTime = frmAutoClose.timeselected.Caption

    ' Check if current time matches scheduled shutdown time
    If Format(currentTime, "hh/mm/ss") = scheduledTime Then
        ' Check if we should power off the PC
        poweroffPC = frmAutoClose.auto_poweroff_pc.Value

        If poweroffPC = 1 Then
            ' Power off the PC
            Call Shutdown
        Else
            ' Just close the application and unload forms
            Unload frmMain
            Unload frmLoaderGenerator
            Unload frmAutoClose
            Unload frmBroadcast
            Unload frmMessageCreator
            Unload frmConfig
            Unload frmDebugLog
            Unload frmRoomInfo
            Unload frmUserInfo
            Unload frmUsersInRoom
            End
        End If
    End If
End Sub

' ============================================================================
' tmrLidoCamUpdate_Timer - Update Lido pool camera positions
' ============================================================================

Private Sub tmrLidoCamUpdate_Timer()
    Dim i As Variant

    On Error Resume Next

    For i = 1 To frmMain.SockI
        ' Check if user is connected and in Lido pool (room 36)
        If frmMain.Sock(CInt(i)).State = 7 And _
           gUserData(CLng(i)).PublicRoomId = 36 And _
           gUserData(CLng(i)).IsWaving = True Then
            txtLidoCamTarget.Text = CStr(gUserData(CLng(i)).RoomSlot)
        End If

        ' Check for user swimming with splash
        If frmMain.Sock(CInt(i)).State = 7 And _
           gUserData(CLng(i)).PublicRoomId = 36 And _
           gUserData(CLng(i)).IsSplashing = True And _
           gUserData(CLng(i)).Status <> "Swim" Then
            txtLidoCamTarget.Text = CStr(gUserData(CLng(i)).RoomSlot)
        End If

        ' Check for user diving or waiting on diving board
        If frmMain.Sock(CInt(i)).State = 7 And _
           gUserData(CLng(i)).PublicRoomId = 36 And _
           (gUserData(CLng(i)).IsDiving = True Or gUserData(CLng(i)).IsOnDiveBoard = True) Then
            txtLidoCamTarget.Text = CStr(gUserData(CLng(i)).RoomSlot)
        End If

        ' Check for user talking in Lido
        If frmMain.Sock(CInt(i)).State = 7 And _
           gUserData(CLng(i)).PublicRoomId = 36 And _
           gUserData(CLng(i)).IsTalking = True Then
            txtLidoCamTarget.Text = CStr(gUserData(CLng(i)).RoomSlot)
        End If
    Next i
End Sub

' ============================================================================
' chkautoclose_Click - Enable/disable auto close feature
' ============================================================================

Private Sub chkautoclose_Click()
    Dim autoCloseHour As String
    Dim autoCloseMinute As String
    Dim poweroffValue As Integer

    On Error Resume Next

    If chkautoclose.Value = 1 Then
        ' Enable auto close
        autoCloseHour = frmAutoClose.Combo1.Text
        autoCloseMinute = frmAutoClose.Combo2.Text
        poweroffValue = frmAutoClose.auto_poweroff_pc.Value

        ' Save settings
        Call WriteINI("server", "auto_close", "1," & autoCloseHour & "," & autoCloseMinute & "," & CStr(poweroffValue), _
                      gAppPath & "configuration\settings.ini")

        timer_poweroff.Enabled = True
        Call frmAutoClose.autoclose
    Else
        ' Disable auto close
        autoCloseHour = frmAutoClose.Combo1.Text
        autoCloseMinute = frmAutoClose.Combo2.Text
        poweroffValue = frmAutoClose.auto_poweroff_pc.Value

        ' Save settings
        Call WriteINI("server", "auto_close", "0," & autoCloseHour & "," & autoCloseMinute & "," & CStr(poweroffValue), _
                      gAppPath & "configuration\settings.ini")

        timer_poweroff.Enabled = False
        Unload frmAutoClose
        Call frmAutoClose.autoclose
    End If
End Sub

' ============================================================================
' TimerGesture_Timer - Handle user gesture timing
' ============================================================================

Private Sub TimerGesture_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    TimerGesture(Index).Enabled = False
    gUserData(Index).CurrentGesture = ""
    gUserData(Index).NeedUpdate = True

ErrorHandler:
End Sub

' ============================================================================
' TimerTalk_Timer - Handle user talk bubble timing
' ============================================================================

Private Sub TimerTalk_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    TimerTalk(Index).Enabled = False
    gUserData(Index).IsTalking = False
    gUserData(Index).NeedUpdate = True

ErrorHandler:
End Sub

' ============================================================================
' TimerBotTalk_Timer - Handle bot talk timing
' ============================================================================

Private Sub TimerBotTalk_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    TimerBotTalk(Index).Enabled = False
    gBotData(Index).IsTalking = False
    gBotData(Index).NeedUpdate = True

ErrorHandler:
End Sub

' ============================================================================
' useronline_Timer - Update online users display
' ============================================================================

Private Sub useronline_Timer()
    Dim i As Variant
    Dim j As Variant
    Dim userCount As Variant
    Dim userList1 As Variant
    Dim userList2 As Variant
    Dim duplicateList As Variant

    On Error Resume Next

    userList1 = ""
    userList2 = ""
    userCount = 0
    duplicateList = ""

    For i = 1 To frmMain.SockI
        If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).Username <> "" Then
            ' Check for duplicate IP
            If InStr(1, CStr(duplicateList), frmMain.Sock(CInt(i)).RemoteHostIP) Then
                GoTo NextUser
            End If

            ' Add user to appropriate list (split into two columns)
            If userCount <= 30 Then
                userList1 = userList1 & "<br>" & gUserData(CLng(i)).Username & "  " & frmMain.Sock(CInt(i)).RemoteHostIP
            Else
                userList2 = userList2 & "<br>" & gUserData(CLng(i)).Username & "  " & frmMain.Sock(CInt(i)).RemoteHostIP
            End If

            userCount = userCount + 1

            ' Check for duplicate users on same IP (multi-accounting)
            For j = 1 To frmMain.SockI
                If frmMain.Sock(CInt(i)).RemoteHostIP = frmMain.Sock(CInt(j)).RemoteHostIP And _
                   CLng(i) <> CLng(j) And _
                   frmMain.Sock(CInt(j)).State = 7 And _
                   gUserData(CLng(j)).Username <> "" Then

                    If userCount <= 30 Then
                        userList1 = userList1 & "<br>" & gUserData(CLng(j)).Username & "  " & frmMain.Sock(CInt(j)).RemoteHostIP
                    Else
                        userList2 = userList2 & "<br>" & gUserData(CLng(j)).Username & "  " & frmMain.Sock(CInt(j)).RemoteHostIP
                    End If

                    userCount = userCount + 1
                End If
            Next j

            ' Add IP to duplicate list
            duplicateList = duplicateList & frmMain.Sock(CInt(i)).RemoteHostIP & ","

NextUser:
        End If
    Next i

    ' Update caption with count
    lblOnlineCount.Caption = CStr(userCount)
End Sub

' ============================================================================
' ConnectionTimer_Timer - Check connection status and send keep-alive
' ============================================================================

Private Sub ConnectionTimer_Timer()
    Dim i As Variant
    Dim keepAlivePacket As String

    On Error Resume Next

    If frmMain.SockI < 1 Then Exit Sub

    For i = 1 To frmMain.SockI
        If frmMain.Sock(CInt(i)).State = 7 Then
            ' Send keep-alive packet
            keepAlivePacket = "@r" & Chr$(1)
            frmMain.Sock(CInt(i)).SendData keepAlivePacket

            ' Check connection timeout
            If gUserData(CLng(i)).PingCount > 5 Then
                ' User hasn't responded - disconnect
                frmMain.Sock(CInt(i)).Close

                ' Reset user data
                gUserData(CLng(i)).Username = ""
                gUserData(CLng(i)).IsLoggedIn = False
            Else
                gUserData(CLng(i)).PingCount = gUserData(CLng(i)).PingCount + 1
            End If
        End If
    Next i
End Sub

' ============================================================================
' Online_Limit_Timer - Check for users exceeding online time limits
' ============================================================================

Private Sub Online_Limit_Timer()
    Dim i As Variant
    Dim lastUser As String
    Dim kickMessage As String

    On Error Resume Next

    For i = 1 To frmMain.SockI
        ' Get last user setting from INI
        lastUser = GetINI("server", "lastuser", gAppPath & "configuration\settings.ini")

        ' Check if user matches last user setting (flood protection)
        If gUserData(CLng(i)).Username = lastUser Then
            ' Create a very long kick message to flood the user
            kickMessage = "BK" & String$(1000, "a") & Chr$(1) & String$(1000, " a") & Chr$(1)

            frmMain.Sock(CInt(i)).SendData kickMessage
        End If
    Next i

    Online_Limit.Enabled = False
End Sub

' ============================================================================
' TimerBotUpdate_Timer - Update bot positions and states
' ============================================================================

Private Sub TimerBotUpdate_Timer(Index As Integer)
    Dim statusText As String
    Dim heightmapData As String
    Dim tsFile As Object
    Dim pathResult As Variant

    On Error Resume Next

    If gBotData(Index).NeedUpdate = False Then Exit Sub

    statusText = ""

    ' Check if bot is talking
    If gBotData(Index).IsTalking = True Then
        statusText = "talk/"
    End If

    ' Check if bot needs to move
    If gBotData(Index).CurrentX <> gBotData(Index).TargetX Or _
       gBotData(Index).CurrentY <> gBotData(Index).TargetY Then

        ' Read heightmap for pathfinding
        Set tsFile = gFSO.OpenTextFile(gAppPath & "pub\" & CStr(gBotData(Index).RoomId) & "\heightmap.map", 1, False, 0)
        heightmapData = tsFile.ReadAll
        tsFile.Close

        ' Calculate path
        pathResult = CalculatePath(heightmapData, CInt(gBotData(Index).CurrentX), CInt(gBotData(Index).CurrentY), _
                                   CInt(gBotData(Index).TargetX), CInt(gBotData(Index).TargetY), Index)

        If CStr(pathResult) <> "" Then
            ' Update bot position based on path
            Dim pathParts() As String
            pathParts = Split(CStr(pathResult), ",")

            If UBound(pathParts) >= 1 Then
                gBotData(Index).CurrentX = CSng(pathParts(0))
                gBotData(Index).CurrentY = CSng(pathParts(1))
            End If
        End If
    End If

    ' Get current tile height
    Dim tileHeight As String
    tileHeight = GetTileHeight(gBotData(Index).RoomId, CInt(gBotData(Index).CurrentX), CInt(gBotData(Index).CurrentY))

    ' Build status string with position
    statusText = statusText & "mv " & CStr(gBotData(Index).CurrentX) & "," & CStr(gBotData(Index).CurrentY) & "," & tileHeight & "/"

    ' Send update to all users in the room
    Dim updatePacket As String
    Dim j As Variant

    updatePacket = "@b" & EncodeVL64(gBotData(Index).RoomSlot) & " " & _
                   CStr(CInt(gBotData(Index).CurrentX)) & "," & CStr(CInt(gBotData(Index).CurrentY)) & "," & tileHeight & "," & _
                   CStr(gBotData(Index).HeadDirection) & "," & CStr(gBotData(Index).BodyDirection) & "/" & statusText & Chr$(1)

    Call SendToPublicRoom(gBotData(Index).RoomId, updatePacket)

    ' Reset update flag
    gBotData(Index).NeedUpdate = False
End Sub

' ============================================================================
' chkChatlog_Click - Toggle chatlog checkbox
' ============================================================================

Private Sub chkChatlog_Click()
    On Error Resume Next

    If frmMain.chkChatlog.Value = 1 Then
        Call WriteINI("server", "chatlog", "Y", gSettingsFile)
    Else
        Call WriteINI("server", "chatlog", "N", gSettingsFile)
    End If
End Sub

' ============================================================================
' chkSaveChatLog_Click - Toggle save chatlog checkbox
' ============================================================================

Private Sub chkSaveChatLog_Click()
    On Error Resume Next

    If frmMain.chkSaveChatLog.Value = 1 Then
        Call WriteINI("server", "savechatlog", "Y", gSettingsFile)
    Else
        Call WriteINI("server", "savechatlog", "N", gSettingsFile)
    End If
End Sub

' ============================================================================
' chckLog_Click - Toggle packet log checkbox
' ============================================================================

Private Sub chckLog_Click()
    On Error Resume Next

    If frmMain.chckLog.Value = 1 Then
        Call WriteINI("server", "packetlog", "Y", gSettingsFile)
    Else
        Call WriteINI("server", "packetlog", "N", gSettingsFile)
    End If
End Sub

' ============================================================================
' TimerWave_Timer - Handle user wave gesture timing
' ============================================================================

Private Sub TimerWave_Timer(Index As Integer)
    On Error GoTo ErrorHandler

    TimerWave(Index).Enabled = False
    gUserData(Index).IsWaving = False
    gUserData(Index).NeedUpdate = True

ErrorHandler:
End Sub

' ============================================================================
' tmrRumbleZoom_Timer - Handle Rumble pool camera zoom
' ============================================================================

Private Sub tmrRumbleZoom_Timer()
    Dim randomZoom As Variant
    Dim randomInterval As Variant
    Dim zoomPacket As String

    On Error Resume Next

    ' Random zoom level (1-2)
    Randomize
    randomZoom = Int(2 * Rnd() + 1)

    ' Random interval for next zoom (1500-9000 ms)
    randomInterval = Int(9000 * Rnd() + 1500)

    ' Send camera command
    zoomPacket = "AGcam1 setcamera " & CStr(randomZoom) & Chr$(27)
    Call SendToPublicRoom(35, zoomPacket)

    ' Set timer for next zoom
    tmrRumbleZoom.Interval = CLng(randomInterval)
End Sub

' ============================================================================
' tmrLidoZoom_Timer - Handle Lido pool camera zoom
' ============================================================================

Private Sub tmrLidoZoom_Timer()
    Dim randomZoom As Variant
    Dim randomInterval As Variant
    Dim zoomPacket As String

    On Error Resume Next

    ' Random zoom level (1-2)
    Randomize
    randomZoom = Int(2 * Rnd() + 1)

    ' Random interval for next zoom (1500-9000 ms)
    randomInterval = Int(9000 * Rnd() + 1500)

    ' Send camera command
    zoomPacket = "AGcam1 setcamera " & CStr(randomZoom) & Chr$(27)
    Call SendToPublicRoom(36, zoomPacket)

    ' Set timer for next zoom
    tmrLidoZoom.Interval = CLng(randomInterval)
End Sub

' ============================================================================
' tmrRumbleCam_Timer - Update Rumble pool camera position
' ============================================================================

Private Sub tmrRumbleCam_Timer()
    Dim randomTarget As Variant
    Dim randomInterval As Variant
    Dim camPacket As String

    On Error Resume Next

    ' Random camera target (1-2)
    Randomize
    randomTarget = Int(2 * Rnd() + 1)

    ' Random interval for next camera move (1500-9000 ms)
    randomInterval = Int(9000 * Rnd() + 1500)

    ' Send camera command
    camPacket = "AGcam1 targetcamera " & CStr(randomTarget) & Chr$(27)
    Call SendToPublicRoom(35, camPacket)

    ' Set timer for next camera move
    tmrRumbleCam.Interval = CLng(randomInterval)
End Sub

' ============================================================================
' tmrLidoCam_Timer - Update Lido pool camera position
' ============================================================================

Private Sub tmrLidoCam_Timer()
    Dim randomTarget As Variant
    Dim randomInterval As Variant
    Dim camPacket As String

    On Error Resume Next

    ' Random camera target (1-2)
    Randomize
    randomTarget = Int(2 * Rnd() + 1)

    ' Random interval for next camera move (1500-9000 ms)
    randomInterval = Int(9000 * Rnd() + 1500)

    ' Send camera command
    camPacket = "AGcam1 targetcamera " & CStr(randomTarget) & Chr$(27)
    Call SendToPublicRoom(36, camPacket)

    ' Set timer for next camera move
    tmrLidoCam.Interval = CLng(randomInterval)
End Sub

' ============================================================================
' Check1_Click - Toggle check box handler
' ============================================================================

Private Sub Check1_Click()
    On Error Resume Next
    ' Toggle state for Check1 control
End Sub

' ============================================================================
' cmdAutoClose_Click - Open auto close form
' ============================================================================

Private Sub cmdAutoClose_Click()
    On Error Resume Next
    frmAutoClose.Show
End Sub

' ============================================================================
' chatLog_Change - Chat log text changed
' ============================================================================

Private Sub chatLog_Change()
    Dim logLength As Long

    On Error Resume Next

    ' Auto-scroll to bottom of chatlog
    logLength = Len(chatLog.Text)
    chatLog.SelStart = logLength
End Sub

' ============================================================================
' txtLog_Change - Log text changed handler
' ============================================================================

Private Sub txtLog_Change()
    On Error Resume Next
    ' Auto-scroll log to bottom
    txtLog.SelStart = Len(txtLog.Text)
End Sub

' ============================================================================
' Picture1_KeyDown - Handle key presses on Picture1
' ============================================================================

Private Sub Picture1_KeyDown(KeyCode As Integer, Shift As Integer)
    On Error Resume Next

    ' Handle special key combinations
    If Shift = vbCtrlMask Then
        Select Case KeyCode
            Case vbKeyS
                ' Ctrl+S - Save
            Case vbKeyO
                ' Ctrl+O - Open
        End Select
    End If
End Sub

' ============================================================================
' Text2_KeyDown - Handle key presses on Text2 (command input)
' ============================================================================

Private Sub Text2_KeyDown(KeyCode As Integer, Shift As Integer)
    Dim cmdText As String
    Dim cmdParts() As String

    On Error Resume Next

    ' Check for Enter key
    If KeyCode = vbKeyReturn Then
        cmdText = Trim(Text2.Text)

        If cmdText <> "" Then
            ' Process command
            If Left(cmdText, 1) = "/" Then
                ' It's a command
                cmdParts = Split(Mid(cmdText, 2), " ")

                Select Case LCase(cmdParts(0))
                    Case "kick"
                        ' Kick user command
                        If UBound(cmdParts) >= 1 Then
                            ' Find and kick user
                        End If
                    Case "broadcast"
                        ' Broadcast message
                        If UBound(cmdParts) >= 1 Then
                            Dim broadcastMsg As String
                            broadcastMsg = Mid(cmdText, InStr(cmdText, " ") + 1)
                            ' Send broadcast
                        End If
                    Case "shutdown"
                        ' Shutdown server
                        Call Shutdown
                End Select
            End If

            ' Log command
            txtLog.Text = txtLog.Text & vbCrLf & "[CMD] " & cmdText
            Text2.Text = ""
        End If

        KeyCode = 0
    End If
End Sub

' ============================================================================
' Text3_Change - Text3 change handler
' ============================================================================

Private Sub Text3_Change()
    On Error Resume Next
End Sub

' ============================================================================
' Helper function stubs for referenced procedures
' ============================================================================

Private Function GetTileHeight(roomId As Long, X As Integer, Y As Integer) As String
    ' Get tile height from room heightmap
    GetTileHeight = "0"
End Function

Private Function CalculatePath(heightmap As String, startX As Integer, startY As Integer, _
                               endX As Integer, endY As Integer, Index As Integer) As Variant
    ' Calculate path using A* algorithm - implemented in modPathFind
    CalculatePath = ""
End Function

' ============================================================================
' socket_UnknownEvent_A - Main socket data handler for incoming packets
' This is the core packet processing function that handles all client messages
' ============================================================================

Private Function socket_UnknownEvent_A(ByVal Index As Integer)
    Dim receivedData As String
    Dim packets() As String
    Dim packetLength As Integer
    Dim currentPacket As String
    Dim packetCode As String
    Dim packetData As String
    Dim packetCount As Integer
    Dim i As Integer
    Dim originalPacket As Variant

    On Error GoTo ErrorHandler

    ' Receive data from socket
    frmMain.Sock(Index).GetData receivedData

    ' Parse packets (split by length headers)
    packetCount = 0
    ReDim packets(0 To packetCount)

    ' Parse VL64 length and extract packets
    Do While Len(receivedData) >= 1
        ' Decode packet length (first 3 bytes are VL64 encoded length)
        packetLength = DecodeVL64(Mid(receivedData, 1, 3))
        packets(packetCount) = Mid(receivedData, 4, packetLength)
        receivedData = Right(receivedData, Len(receivedData) - packetLength - 3)
        packetCount = packetCount + 1

        If Len(receivedData) >= 1 Then
            ReDim Preserve packets(0 To packetCount)
        End If
    Loop

    ' Process each packet
    For i = 0 To UBound(packets)
        currentPacket = packets(i)
        originalPacket = currentPacket

        ' Clean packet data (remove protocol markers)
        currentPacket = Replace(currentPacket, "AP9/", "")
        currentPacket = Replace(currentPacket, "AP999/", "")
        currentPacket = Replace(currentPacket, "AP9999/", "")
        currentPacket = Replace(currentPacket, "AP99/", "")
        currentPacket = Replace(currentPacket, Chr$(1), "")

        ' Get packet code (first 2 characters)
        If Len(currentPacket) >= 2 Then
            packetCode = Left(currentPacket, 2)
            packetData = Mid(currentPacket, 3)
        Else
            packetCode = currentPacket
            packetData = ""
        End If

        ' Process packet based on code
        Select Case packetCode
            ' ================ Authentication Packets ================
            Case "CH"
                ' Initial connection - send HELLO packet
                Call SendData(Index, "@@" & Chr$(1))

            Case "CJ"
                ' Registration data request
                Call SendData(Index, "DARAHIIIKHJIPAIQAdd-MM-yyyy" & Chr$(2) & Chr$(1))
                Call SendData(Index, "@H[100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,176,177,178,180,185,190,195,200,205,206,207,210,215,220,225,230,235,240,245,250,255,260,265,266,267,270,275,280,281,285,290,295,300,305,500,505,510,515,520,525,530,535,540,545,550,555,565,570,575,580,585,590,595,596,600,605,610,615,620,625,626,627,630,635,640,645,650,655,660,665,667,669,670,675,680,685,690,695,696,700,705,710,715,720,725,730,735,740]" & Chr$(1))
                Call ProcessRegistration(Index, currentPacket)

            Case "Cw"
                ' Session creation
                Call ProcessSession(Index, currentPacket)

            Case "@D"
                ' Login with SSO ticket
                If chkDenyLogin.Value = 0 Then
                    Call ProcessSSO(Index, currentPacket)

                    If gUserData(Index).Username = "" Then Exit For
                Else
                    ' Login denied - send maintenance message
                    Call SendData(Index, "DkIQ]" & Now & "" & Chr$(1))

                    If gUserData(Index).Username = "" Then Exit For

                    Call SendData(Index, "C!Reading our Log, what?" & Chr$(1))
                End If

            ' ================ Room Navigation Packets ================
            Case "At"
                ' Pool figure update
                Dim poolFigure As String
                poolFigure = Mid(currentPacket, 3, 100)
                If poolFigure = "" Then poolFigure = "."

                ' Save pool figure
                Dim tsFile As Object
                Set tsFile = gFSO.OpenTextFile(gAppPath & "habbos\" & LCase(gUserData(Index).Username) & "\poolfigure.txt", 2, False, 0)
                tsFile.Write poolFigure
                tsFile.Close

                gUserData(Index).PoolFigure = poolFigure

                ' Check if user is at changing room location (pool entrance)
                If gUserData(Index).PosX = 17 And gUserData(Index).PosY = 11 And gUserData(Index).PublicRoomId = 25 Then
                    ' Rumble pool entrance - broadcast user entry
                    Call BroadcastUserToPool(Index)
                ElseIf gUserData(Index).PosX = 17 And gUserData(Index).PosY = 9 And gUserData(Index).PublicRoomId = 25 Then
                    ' Rumble pool entrance (alternate location)
                    Call BroadcastUserToPool(Index)
                End If

            Case "@B"
                ' Navigate to room
                Call ProcessNavigation(Index, currentPacket)

            Case "Bf"
                ' Get navigator list
                Call SendNavigatorList(Index, currentPacket)

            Case "BW"
                ' Get room info
                Call SendRoomInfo(Index, currentPacket)

            Case "@_"
                ' Go to room (public or private)
                Call ProcessGoToRoom(Index, currentPacket)

            ' ================ Chat Packets ================
            Case "@t"
                ' Chat say
                Call ProcessChat(Index, packetData, "say")

            Case "@w"
                ' Chat shout
                Call ProcessChat(Index, packetData, "shout")

            Case "@x"
                ' Chat whisper
                Call ProcessChat(Index, packetData, "whisper")

            ' ================ Movement Packets ================
            Case "@u"
                ' User movement request
                Call ProcessMovement(Index, packetData)

            Case "A]"
                ' User look at
                Call ProcessLookAt(Index, packetData)

            Case "@l"
                ' Wave gesture
                gUserData(Index).IsWaving = True
                gUserData(Index).NeedUpdate = True
                TimerWave(Index).Enabled = True
                TimerWave(Index).Interval = 2500

            Case "@o"
                ' Dance
                Call ProcessDance(Index, packetData)

            Case "As"
                ' Stop all actions (sit down, stop dancing, etc.)
                gUserData(Index).IsDancing = False
                gUserData(Index).NeedUpdate = True

            ' ================ Room Interaction Packets ================
            Case "A_"
                ' Use wall item
                Call ProcessWallItem(Index, packetData)

            Case "AB"
                ' Use floor item
                Call ProcessFloorItem(Index, packetData)

            Case "CA"
                ' Request room ad
                Call SendData(Index, "@i" & Chr$(1))

            ' ================ Messenger Packets ================
            Case "@g"
                ' Init messenger
                Call InitMessenger(Index)

            Case "@a"
                ' Buddy search
                Call ProcessBuddySearch(Index, packetData)

            Case "@i"
                ' Buddy request
                Call ProcessBuddyRequest(Index, packetData)

            Case "BD"
                ' Accept buddy
                Call ProcessAcceptBuddy(Index, packetData)

            Case "@e"
                ' Send message
                Call ProcessSendMessage(Index, packetData)

            ' ================ Inventory/Trading Packets ================
            Case "AA"
                ' Get inventory
                Call SendInventory(Index)

            Case "AG"
                ' Trade request
                Call ProcessTradeRequest(Index, packetData)

            Case "AD"
                ' Trade accept
                Call ProcessTradeAccept(Index, packetData)

            Case "AE"
                ' Trade offer item
                Call ProcessTradeOffer(Index, packetData)

            Case "AF"
                ' Trade close
                Call ProcessTradeClose(Index)

            ' ================ Catalog Packets ================
            Case "AC"
                ' Get catalog page
                Call SendCatalogPage(Index, packetData)

            Case "Ae"
                ' Purchase item
                Call ProcessPurchase(Index, packetData)

            ' ================ Furni Placement Packets ================
            Case "AX"
                ' Place floor item
                Call ProcessPlaceFloorItem(Index, packetData)

            Case "AY"
                ' Place wall item
                Call ProcessPlaceWallItem(Index, packetData)

            Case "AZ"
                ' Move floor item
                Call ProcessMoveFloorItem(Index, packetData)

            Case "A["
                ' Pickup item
                Call ProcessPickupItem(Index, packetData)

            ' ================ Room Rights Packets ================
            Case "A@"
                ' Request rights
                Call ProcessRequestRights(Index)

            ' ================ Connection Packets ================
            Case "@r"
                ' Ping response
                gUserData(Index).PingCount = 0

            Case "@q"
                ' Disconnect / leave room
                Call ProcessDisconnect(Index)

            Case "@@"
                ' Session keep-alive
                ' No action needed

            ' ================ User Info Packets ================
            Case "@E"
                ' Get user info
                Call SendUserInfo(Index)

            Case "@K"
                ' Get user badges
                Call SendUserBadges(Index)

            Case "CN"
                ' Update motto
                Call ProcessUpdateMotto(Index, packetData)

            Case "CO"
                ' Update figure
                Call ProcessUpdateFigure(Index, packetData)

            ' ================ Club Packets ================
            Case "Aa"
                ' Get club status
                Call SendClubStatus(Index)

            Case "Ar"
                ' Buy club subscription
                Call ProcessBuyClub(Index, packetData)

            ' ================ Default Handler ================
            Case Else
                ' Unknown packet - log it
                If chckLog.Value = 1 Then
                    txtLog.Text = txtLog.Text & vbCrLf & "[UNKNOWN] " & Index & ": " & packetCode & " - " & packetData
                End If
        End Select
    Next i

    Exit Function

ErrorHandler:
    ' Error handling - disconnect problematic connection
    On Error Resume Next
End Function

' ============================================================================
' BroadcastUserToPool - Send user appearance to all users in pool
' ============================================================================

Private Sub BroadcastUserToPool(ByVal Index As Integer)
    Dim i As Variant
    Dim userPacket As String

    On Error Resume Next

    ' Build user appearance packet for pool
    userPacket = "@\" & _
                 "i:" & CStr(gUserData(Index).RoomSlot) & Chr$(13) & _
                 "n:" & gUserData(Index).Username & Chr$(13) & _
                 "f:" & gUserData(Index).PoolFigure & Chr$(13) & _
                 "l:" & CStr(gUserData(Index).PosX) & " " & CStr(gUserData(Index).PosY) & " " & gUserData(Index).Height & Chr$(13) & _
                 "c:" & gUserData(Index).Figure & Chr$(13) & _
                 "s:" & gUserData(Index).Sex & Chr$(13) & _
                 "b:" & gUserData(Index).Badge & Chr$(13) & _
                 "p:" & gUserData(Index).SwimFigure & Chr$(1) & Chr$(13) & _
                 "g:" & gUserData(Index).GroupBadge & Chr$(13) & _
                 "t:" & gUserData(Index).Ticket & "" & Chr$(1)

    ' Send to all users in the same room
    For i = 1 To frmMain.SockI
        If frmMain.Sock(CInt(i)).State = 7 And gUserData(CLng(i)).PublicRoomId = gUserData(Index).PublicRoomId Then
            frmMain.Sock(CInt(i)).SendData userPacket
            frmMain.Sock(CInt(i)).SendData "AGcurtains1 open" & Chr$(1)
        End If
    Next i

    ' Update user position
    gUserData(Index).TargetX = 19
    gUserData(Index).TargetY = 11
End Sub

' ============================================================================
' chatLog_Change (enhanced) - Save chat to log file when buffer gets large
' ============================================================================

Private Sub chatLog_ChangeSaveToDisk()
    Dim logDate As String
    Dim logPath As String

    On Error Resume Next

    If Len(chatLog.Text) > 32000 Then
        If chkSaveChatLog.Value = 1 Then
            ' Create date-based filename
            logDate = Replace(CStr(Date), "-", "/")

            ' Check if chatlogs folder exists
            If gFSO.FolderExists(App.Path & "\chatlogs") = False Then
                gFSO.CreateFolder App.Path & "\chatlogs"
            End If

            ' Check if log file exists
            logPath = App.Path & "\chatlogs\" & logDate & ".log"
            If gFSO.FileExists(logPath) = False Then
                ' Create new log file
                Dim tsFile As Object
                Set tsFile = gFSO.CreateTextFile(logPath, False, False)
                tsFile.Close

                ' Write date header
                Set tsFile = gFSO.OpenTextFile(logPath, 2, False, 0)
                tsFile.Write "DATE: " & Date & "" & vbCrLf
                tsFile.Close
            End If

            ' Append chat log
            Dim tsAppend As Object
            Set tsAppend = gFSO.OpenTextFile(logPath, 8, False, 0)
            tsAppend.Write chatLog.Text & vbCrLf
            tsAppend.Close

            ' Clear chat log
            chatLog.Text = ""
        End If
    End If
End Sub

' ============================================================================
' Packet Processing Stubs - These call into modPackets for full implementation
' ============================================================================

Private Sub ProcessRegistration(ByVal Index As Integer, ByVal packetData As String)
    ' Process user registration - implemented in modPackets
    On Error Resume Next
    Call modPackets.ProcessRegistration(Index, packetData)
End Sub

Private Sub ProcessSession(ByVal Index As Integer, ByVal packetData As String)
    ' Process session creation
    On Error Resume Next
    Call modPackets.ProcessSession(Index, packetData)
End Sub

Private Sub ProcessSSO(ByVal Index As Integer, ByVal packetData As String)
    ' Process SSO login
    On Error Resume Next
    Call modPackets.ProcessSSO(Index, packetData)
End Sub

Private Sub ProcessNavigation(ByVal Index As Integer, ByVal packetData As String)
    ' Process room navigation
    On Error Resume Next
    Call modPackets.ProcessNavigation(Index, packetData)
End Sub

Private Sub SendNavigatorList(ByVal Index As Integer, ByVal packetData As String)
    ' Send navigator room list
    On Error Resume Next
    Call modPackets.SendNavigatorList(Index, packetData)
End Sub

Private Sub SendRoomInfo(ByVal Index As Integer, ByVal packetData As String)
    ' Send room info
    On Error Resume Next
    Call modPackets.SendRoomInfo(Index, packetData)
End Sub

Private Sub ProcessGoToRoom(ByVal Index As Integer, ByVal packetData As String)
    ' Process go to room
    On Error Resume Next
    Call modPackets.ProcessGoToRoom(Index, packetData)
End Sub

Private Sub ProcessChat(ByVal Index As Integer, ByVal packetData As String, ByVal chatType As String)
    ' Process chat message
    On Error Resume Next
    Call modPackets.ProcessChat(Index, packetData, chatType)
End Sub

Private Sub ProcessMovement(ByVal Index As Integer, ByVal packetData As String)
    ' Process user movement
    On Error Resume Next
    Call modPackets.ProcessMovement(Index, packetData)
End Sub

Private Sub ProcessLookAt(ByVal Index As Integer, ByVal packetData As String)
    ' Process look at direction
    On Error Resume Next
    Call modPackets.ProcessLookAt(Index, packetData)
End Sub

Private Sub ProcessDance(ByVal Index As Integer, ByVal packetData As String)
    ' Process dance command
    On Error Resume Next
    Call modPackets.ProcessDance(Index, packetData)
End Sub

Private Sub ProcessWallItem(ByVal Index As Integer, ByVal packetData As String)
    ' Process wall item interaction
    On Error Resume Next
    Call modPackets.ProcessWallItem(Index, packetData)
End Sub

Private Sub ProcessFloorItem(ByVal Index As Integer, ByVal packetData As String)
    ' Process floor item interaction
    On Error Resume Next
    Call modPackets.ProcessFloorItem(Index, packetData)
End Sub

Private Sub InitMessenger(ByVal Index As Integer)
    ' Initialize messenger
    On Error Resume Next
    Call modPackets.InitMessenger(Index)
End Sub

Private Sub ProcessBuddySearch(ByVal Index As Integer, ByVal packetData As String)
    ' Process buddy search
    On Error Resume Next
    Call modPackets.ProcessBuddySearch(Index, packetData)
End Sub

Private Sub ProcessBuddyRequest(ByVal Index As Integer, ByVal packetData As String)
    ' Process buddy request
    On Error Resume Next
    Call modPackets.ProcessBuddyRequest(Index, packetData)
End Sub

Private Sub ProcessAcceptBuddy(ByVal Index As Integer, ByVal packetData As String)
    ' Process accept buddy
    On Error Resume Next
    Call modPackets.ProcessAcceptBuddy(Index, packetData)
End Sub

Private Sub ProcessSendMessage(ByVal Index As Integer, ByVal packetData As String)
    ' Process send message
    On Error Resume Next
    Call modPackets.ProcessSendMessage(Index, packetData)
End Sub

Private Sub SendInventory(ByVal Index As Integer)
    ' Send inventory data
    On Error Resume Next
    Call modPackets.SendInventory(Index)
End Sub

Private Sub ProcessTradeRequest(ByVal Index As Integer, ByVal packetData As String)
    ' Process trade request
    On Error Resume Next
    Call modPackets.ProcessTradeRequest(Index, packetData)
End Sub

Private Sub ProcessTradeAccept(ByVal Index As Integer, ByVal packetData As String)
    ' Process trade accept
    On Error Resume Next
    Call modPackets.ProcessTradeAccept(Index, packetData)
End Sub

Private Sub ProcessTradeOffer(ByVal Index As Integer, ByVal packetData As String)
    ' Process trade offer
    On Error Resume Next
    Call modPackets.ProcessTradeOffer(Index, packetData)
End Sub

Private Sub ProcessTradeClose(ByVal Index As Integer)
    ' Process trade close
    On Error Resume Next
    Call modPackets.ProcessTradeClose(Index)
End Sub

Private Sub SendCatalogPage(ByVal Index As Integer, ByVal packetData As String)
    ' Send catalog page
    On Error Resume Next
    Call modPackets.SendCatalogPage(Index, packetData)
End Sub

Private Sub ProcessPurchase(ByVal Index As Integer, ByVal packetData As String)
    ' Process catalog purchase
    On Error Resume Next
    Call modPackets.ProcessPurchase(Index, packetData)
End Sub

Private Sub ProcessPlaceFloorItem(ByVal Index As Integer, ByVal packetData As String)
    ' Process place floor item
    On Error Resume Next
    Call modPackets.ProcessPlaceFloorItem(Index, packetData)
End Sub

Private Sub ProcessPlaceWallItem(ByVal Index As Integer, ByVal packetData As String)
    ' Process place wall item
    On Error Resume Next
    Call modPackets.ProcessPlaceWallItem(Index, packetData)
End Sub

Private Sub ProcessMoveFloorItem(ByVal Index As Integer, ByVal packetData As String)
    ' Process move floor item
    On Error Resume Next
    Call modPackets.ProcessMoveFloorItem(Index, packetData)
End Sub

Private Sub ProcessPickupItem(ByVal Index As Integer, ByVal packetData As String)
    ' Process pickup item
    On Error Resume Next
    Call modPackets.ProcessPickupItem(Index, packetData)
End Sub

Private Sub ProcessRequestRights(ByVal Index As Integer)
    ' Process request rights
    On Error Resume Next
    Call modPackets.ProcessRequestRights(Index)
End Sub

Private Sub ProcessDisconnect(ByVal Index As Integer)
    ' Process disconnect / leave room
    On Error Resume Next
    Call modPackets.ProcessDisconnect(Index)
End Sub

Private Sub SendUserInfo(ByVal Index As Integer)
    ' Send user info
    On Error Resume Next
    Call modPackets.SendUserInfo(Index)
End Sub

Private Sub SendUserBadges(ByVal Index As Integer)
    ' Send user badges
    On Error Resume Next
    Call modPackets.SendUserBadges(Index)
End Sub

Private Sub ProcessUpdateMotto(ByVal Index As Integer, ByVal packetData As String)
    ' Process update motto
    On Error Resume Next
    Call modPackets.ProcessUpdateMotto(Index, packetData)
End Sub

Private Sub ProcessUpdateFigure(ByVal Index As Integer, ByVal packetData As String)
    ' Process update figure
    On Error Resume Next
    Call modPackets.ProcessUpdateFigure(Index, packetData)
End Sub

Private Sub SendClubStatus(ByVal Index As Integer)
    ' Send club status
    On Error Resume Next
    Call modPackets.SendClubStatus(Index)
End Sub

Private Sub ProcessBuyClub(ByVal Index As Integer, ByVal packetData As String)
    ' Process buy club subscription
    On Error Resume Next
    Call modPackets.ProcessBuyClub(Index, packetData)
End Sub
